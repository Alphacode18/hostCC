<!-- templates/dashboard.html -->
<!DOCTYPE html>
<html>
<head>
    <title>hostCC Dashboard</title>
    <!-- <link rel="stylesheet" type="text/css" href="styles.css"> -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            /* background-color: #badaff; */
            background-color: white;
        }

        .dashboard {
            background-color: #c6c5dc;
            /* display: grid; */
            /* grid-template-columns: repeat(2, 1fr); */
            /* grid-gap: 20px; */
            margin: 5px;
        }

        .header {
            background-color: #c6c5dc;
            /* display: grid; */
            /* grid-template-columns: repeat(2, 1fr); */
            /* grid-gap: 20px; */
            margin-left: 0px;
            margin-right: 10px;
        }

        .dashboard-title {
            font-size: 24px;
            margin: 0;
            text-align: center;
            padding: 10px;
        }

        .dashboard-subtitle {
            font-size: 18px;
            margin: 0;
        }

        .sidebar {
            flex: 20%;
            /* width: 20%; */
            padding: 20px;
            background-color: #fff;
        }

        .main-content {
            flex: 70%;
            padding: 20px;
            /* width: 70%; */
            display: flex;
            justify-content: right;
            align-items: center;
            overflow: auto;
        }

        .plot-grid {
            /* display: grid; */
            /* grid-template-columns: repeat(auto-fit, minmax(calc(50% - 10px), 1fr)); */
            /* grid-template-columns: repeat(auto-fit, minmax(calc(100% - 10px), 1fr)); */
            /* grid-template-columns: repeat(2, 1fr); */
            /* grid-gap: 5px; */
            /* grid-gap: 0px; */

            display: grid;
            grid-template-columns: repeat(1, 1fr); /* 2 columns with equal width */
            grid-template-rows: 204px 204px 204px;    /* 2 rows with equal height */
            grid-gap: 0px;
        }

        .plot {
            background-color: #ffffff;
            border: 1px solid #ddd;
            padding: 5px;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            margin-left: 0px;
            margin-right: 0px;
            margin-top: 3px;
            margin-bottom: 0px;
            /* max-height: calc(45vh - 10px); */
            max-height: calc(30vh - 10px);
        }

        .image-container {
            display: flex;
            justify-content: center; /* Center-align content horizontally */
            padding: 5px;
            margin-top: 10px;
            height: 200px;
            width: auto;
        }

        .fit-to-column {
            max-width: 62%;
            height: auto;
        }

        .plot-container {
            background-color: white;
            margin-top: 0; /* Adjust this value to reduce the top margin */
        }

        .plot-container .plotly .main-svg text.title-text {
            font-size: 18px; /* Adjust the font size as needed */
            margin: 0; /* Adjust this value to reduce the title margin */
        }

        .section {
            display: flex;
            flex-direction: column; /* Display div elements in a column layout */
            align-items: center;
            justify-content: center;
            text-align: center;
            margin-left: 0px;
            margin-right: 10px;
            border-bottom: 1px solid #ccc; /* Add a border to separate sections */
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 5px;
            background-color: rgb(178, 176, 232);
        }

        .section-title {
            margin-top: 0; /* Adjust this value as needed to reduce the top margin */
        }

        .netapp-section {
            display: flex;
            flex-direction: column; /* Display div elements in a column layout */
            align-items: center;
            justify-content: center;
            text-align: center;
            margin-left: 0px;
            margin-right: 10px;
            border-bottom: 1px solid #ccc; /* Add a border to separate sections */
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 5px;
            background-color: rgb(195, 232, 176);
        }

        .mapp-section {
            display: flex;
            flex-direction: column; /* Display div elements in a column layout */
            align-items: center;
            justify-content: center;
            text-align: center;
            margin-left: 0px;
            margin-right: 10px;
            border-bottom: 1px solid #ccc; /* Add a border to separate sections */
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 5px;
            background-color: rgb(239, 217, 168);
        }

        .hostcc-section {
            display: flex;
            flex-direction: column; /* Display div elements in a column layout */
            align-items: center;
            justify-content: center;
            text-align: center;
            margin-left: 0px;
            margin-right: 10px;
            border-bottom: 1px solid #ccc; /* Add a border to separate sections */
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 5px;
            background-color: rgb(204, 203, 232);
        }

        .slider-container {
            display: flex;
            align-items: center;
            margin-right: 20px; /* Add some spacing between label/slider and button */
            margin-left: 20px; /* Add some spacing between label/slider and button */
        }

        .textbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px; /* Add spacing between the textbox and buttons */
        }

        .textbox-label {
            margin-left: 10px; /* Add spacing between the label and textbox */
            margin-right: 20px; /* Add spacing between the label and textbox */
        }

        #core-count {
            width: 40px; /* Adjust the width as needed */
        }

        button {
            padding: 10px 20px;
            background-color: rgb(0, 123, 255);
            color: #ffffff;
            border: none;
            cursor: pointer;
            margin-right: 10px; /* Adjust this value as needed */
            margin-top: 5px; /* Adjust this value as needed */
            margin-bottom: 0px; /* Adjust this value as needed */
        }

        killbutton {
            padding: 10px 20px;
            background-color: #d30d0d;
            color: #ffffff;
            border: none;
            cursor: pointer;
            margin-top: 10px; /* Adjust this value as needed */
            margin-right: 10px; /* Adjust this value as needed */
        }
        killbutton:hover {
            background-color: #990909;
        }

        launchbutton {
            padding: 10px 10px;
            background-color: #e68517;
            color: #ffffff;
            border: none;
            cursor: pointer;
            margin-right: 10px; /* Adjust this value as needed */
            margin-top: 10px; /* Adjust this value as needed */
            margin-bottom: 0px; /* Adjust this value as needed */
        }
        launchbutton:hover {
            background-color: #b96c13;
        }

        droplaunchbutton {
            padding: 10px 10px;
            background-color: white;
            color: black;
            border: none;
            cursor: pointer;
            margin-right: 10px; /* Adjust this value as needed */
            margin-top: 10px; /* Adjust this value as needed */
            margin-bottom: 0px; /* Adjust this value as needed */
        }
        droplaunchbutton:hover {
            background-color: #9ea6af;
        }


        unloadbutton {
            padding: 10px 20px;
            background-color: #d30d0d;
            color: #ffffff;
            border: none;
            cursor: pointer;
            margin-right: 10px; /* Adjust this value as needed */
        }
        unloadbutton:hover {
            background-color: #990909;
        }

        loadbutton {
            padding: 10px 10px;
            background-color: #0fad1a;
            color: #ffffff;
            border: none;
            cursor: pointer;
            margin-right: 10px; /* Adjust this value as needed */
            margin-top: 10px; /* Adjust this value as needed */
            margin-bottom: 0px; /* Adjust this value as needed */
        }
        loadbutton:hover {
            background-color: #0b8813;
        }

        button:hover {
            background-color: #0056b3;
        }

        button,
        killbutton,
        launchbutton,
        unloadbutton,
        loadbutton {
            padding: 5px 0px;
            color: #ffffff;
            border: none;
            cursor: pointer;
            margin-right: 10px; /* Adjust this value as needed */
            width: 70px; /* Set a fixed width for all buttons */
            text-align: center; /* Center-align the text within the button */
        }

        droplaunchbutton {
            padding: 5px 0px;
            color: black;
            border: none;
            cursor: pointer;
            margin-right: 10px; /* Adjust this value as needed */
            width: 70px; 
            text-align: center; /* Center-align the text within the button */
        }

        .column {
        float: left;
        width: 30%;
        }

        /* Clear floats after the columns */
        .column {
        float: left;
        }

        .left {
        width: 21%;
        }

        .right {
        width: 79%;
        }

        .checkboxes {
            padding-bottom: 20px; /* Add padding between checkboxes and the next element */
        }

        .checkboxes label {
            display: flex; /* Use flexbox to align items horizontally */
            align-items: center; /* Center items vertically */
            margin-bottom: -4px; /* Add spacing between checkboxes */
        }

        .checkboxes label input[type="checkbox"] {
            margin-right: 10px; /* Add spacing between checkbox and label */
        }

        label {
            margin-right: 5px; /* Adjust the value as needed */
        }
        .centered-label {
            display: flex; /* Use flexbox to align items horizontally */
            align-items: center; /* Center-align items horizontally */
        }

        .button-container {
            float: right; /* Float the button container to the right */
            display: flex;
            flex-direction: column; /* Stack buttons vertically */
            margin-left: 10px; /* Adjust the margin as needed */
            margin-bottom: 0px; /* Adjust the margin as needed */
        }

        #slider2 {
            width: 90px; /* Adjust the width as needed */
        }
        #slider {
            width: 90px; /* Adjust the width as needed */
        }
        #slider3 {
            width: 90px; /* Adjust the width as needed */
        }

    /* Style for the dropdown container */
    .dropdown {
        position: absolute;
        top: 0;
        right: 0;
        z-index: 1;
    }

    /* Style for the dropdown button with increased width and centered label */
    .dropdown-button {
        background-color: #3498db;
        color: white;
        padding: 10px 20px; /* Increase the width by modifying the padding */
        border: none;
        cursor: pointer;
    }

    /* Style for the dropdown content */
    .dropdown-content {
        display: none;
        position: absolute;
        top: 100%; /* Position below the button */
        right: 0; /* Align with the right edge of the button */
        background-color: #f9f9f9;
        min-width: 150px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        padding: 10px;
        border-radius: 5px;
    }

    /* Style for the checkbox labels (right-aligned) */
    .checkbox-label {
        display: block;
        margin-bottom: 5px;
        text-align: left; /* Right-align the text */
    }

    </style>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="dashboard">
        
        <div class="column left">
            <div class="header">
                <h5 class="dashboard-title">Host Congestion Demo</h5>
            </div>
            <div class="netapp-section">
                <h3 class="section-title"> Throughput Sensitive Network App </h3>
                <div class="slider-container">
                    <label for="slider3" class="slider-label">Num Cores</label>
                    <input type="range" id="slider3" min="1" max="6" value="4">
                    <span id="slider3-value" class="slider3-value">4</span>
                    <div class="button-container">
                        <button id="plus-button3">+</button>
                        <button id="minus-button3">-</button>
                    </div>
                </div>
                <div class="slider-container"> 
                <launchbutton id="button5">Launch</launchbutton>
                <killbutton id="button6" >Stop</killbutton>
                </div>
            </div>
            <div class="netapp-section">
                <h3 class="section-title"> Latency Sensitive <br> Network Application </h3>
                <div class="textbox-container">
                    <label for="core-count" class="slider-label">Request Size (Bytes):</label>
                    <input type="number" id="core-count" min="1" max="1048576" value="128">
                </div>
                <div class="slider-container">
                <launchbutton id="button7">Launch</launchbutton>
                <killbutton id="button8" >Stop</killbutton>
                 </div>
            </div>
            <div class="mapp-section">
                <h3 class="section-title"> Host-Local Application </h3>
                <div class="slider-container">
                    <label for="slider" class="slider-label">Num Cores</label>
                    <input type="range" id="slider" min="1" max="3" value="3">
                    <span id="slider-value" class="slider-value">3</span>
                    <div class="button-container">
                        <button id="plus-button">+</button>
                        <button id="minus-button">-</button>
                    </div>
                </div>
                <div class="slider-container">
                <launchbutton id="button1">Launch</launchbutton>
                <killbutton id="button2" >Stop</killbutton>
                </div>
            </div>
            <div class="hostcc-section">
                <h3 class="section-title"> hostCC controls </h3>
                <div class="checkboxes">
                    <label class="centered-label">
                        <input type="checkbox" id="host-local-checkbox" checked> Host-local congestion response
                    </label>
                    <br>
                    <label class="centered-label">
                        <input type="checkbox" id="network-checkbox" checked> Network congestion response using host congestion signals
                    </label>
                </div>
                <div class="slider-container">
                    <label for="slider2" class="slider-label">Target Network Bandwidth (Gbps)</label>
                    <input type="range" id="slider2" min="10" max="90" step="5" value="80">
                    <span id="slider2-value" class="slider2-value">80</span>
                    <div class="button-container">
                        <button id="plus-button2">+</button>
                        <button id="minus-button2">-</button>
                    </div>
                </div>
                <div class="slider-container">
                <!-- <loadbutton id="button3">Load hostCC</loadbutton> -->
                <launchbutton id="button3">Load</launchbutton>
                <!-- <unloadbutton id="button4">Unload hostCC</unloadbutton> -->
                <killbutton id="button4">Unload</killbutton>
                </div>
            </div>
        </div>
        <div class="column right">
            <div class="image-container"> 
                <img id="dynamic-image" src="/static/no-hostcc.jpg" alt="Dynamic Image" class="fit-to-column">
            </div>
            <div class="dropdown">
                <droplaunchbutton onclick="toggleDropdown()">Metrics</droplaunchbutton>
                <div class="dropdown-content" id="checkbox-list">
                    <label class="checkbox-label"><input type="checkbox" value="pcie" checked onchange="handleCheckboxChange()"> Throughput </label>
                    <label class="checkbox-label"><input type="checkbox" value="latencies" checked onchange="handleCheckboxChange()"> Latency </label>
                    <label class="checkbox-label"><input type="checkbox" value="drop-rates" checked onchange="handleCheckboxChange()"> Drop Rate </label>
                    <label class="checkbox-label"><input type="checkbox" value="iio-occ" onchange="handleCheckboxChange()"> IIO Occupancy </label>
                </div>
            </div>
            <!-- <div class="plot-grid">
                <div class="plot" id="pcie-plot"></div>
                <div class="plot" id="latencies-plot"></div>
                <div class="plot" id="drop-rates-plot"></div>
                <div class="plot" id="iio-occ-plot"></div>
            </div> -->
            <div class="plot-grid" id="custom-plot-grid">
                <!-- This is where the dynamically generated content will go -->
            </div>
        </div>
    </div>



    <!-- <div class="row">
        <div class="column left"> <p> text sdlkjhkjsdh glskgjh skjlfgh lksfg lfkgj lkdfj ldf gd hdhggdhgfjhfj hj hgjk gjk jgk kdf jhlkfdj hlkgdjh kdhj kldgj hgd1 dssd gl lsjgh lsfgh flskgj lkfjg lkflkgj lkfjg lkfjglk jdflkgj lkdfjg lkdfjg lkdfj </p></div>
        <div class="column right">  <p> text sdlkjhkjsdh glskgjh skjlfgh lksfg lfkgj lkdfj ldf gd hdhggdhgfjhfj hj hgjk gjk jgk kdf jhlkfdj hlkgdjh kdhj kldgj hgd1 </p></div>
      </div> -->










    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const slider = document.getElementById('slider');
            const sliderValue = document.getElementById('slider-value');
            slider.addEventListener('input', function () {
                sliderValue.textContent = slider.value;
            });

            var plusButton = document.getElementById("plus-button");
            var minusButton = document.getElementById("minus-button");

            // Function to increase the slider value
            plusButton.addEventListener("click", function () {
                if (slider.value < slider.max) {
                    slider.value = parseInt(slider.value) + 1;
                    updateSliderValue(); // Update the displayed value
                }
            });

            // Function to decrease the slider value
            minusButton.addEventListener("click", function () {
                if (slider.value > slider.min) {
                    slider.value = parseInt(slider.value) - 1;
                    updateSliderValue(); // Update the displayed value
                }
            });

            // Function to update the displayed value
            function updateSliderValue() {
                var sliderValue = document.getElementById("slider-value");
                sliderValue.textContent = slider.value;
            }

            // Call the updateSliderValue function to initialize the displayed value
            updateSliderValue();

            const slider2 = document.getElementById('slider2');
            const slider2Value = document.getElementById('slider2-value');
            slider2.addEventListener('input', function () {
                slider2Value.textContent = slider2.value;
                updateHostCCTargetBWScript('update-hostcc-targetbw',slider2.value)
            });

            var plusButton2 = document.getElementById("plus-button2");
            var minusButton2 = document.getElementById("minus-button2");

            // Function to increase slider2 value
            plusButton2.addEventListener("click", function () {
                if (parseInt(slider2.value) < parseInt(slider2.max)) {
                    slider2.value = String(parseInt(slider2.value) + parseInt(slider2.step));
                    updateSlider2Value();
                }
            });

            // Function to decrease slider2 value
            minusButton2.addEventListener("click", function () {
                if (parseInt(slider2.value) > parseInt(slider2.min)) {
                    slider2.value = String(parseInt(slider2.value) - parseInt(slider2.step));
                    updateSlider2Value();
                }
            });

            // Function to update displayed value for slider2
            function updateSlider2Value() {
                var slider2Value = document.getElementById("slider2-value");
                slider2Value.textContent = slider2.value;
                updateHostCCTargetBWScript('update-hostcc-targetbw',slider2.value)
            }

            // Call the updateSlider2Value function to initialize the displayed value
            updateSlider2Value();

            const slider3 = document.getElementById('slider3');
            const slider3Value = document.getElementById('slider3-value');
            slider3.addEventListener('input', function () {
                slider3Value.textContent = slider3.value;
            });

            var plusButton3 = document.getElementById("plus-button3");
            var minusButton3 = document.getElementById("minus-button3");

            // Function to increase the slider value
            plusButton3.addEventListener("click", function () {
                if (slider3.value < slider3.max) {
                    slider3.value = parseInt(slider3.value) + 1;
                    updateSlider3Value(); // Update the displayed value
                }
            });

            // Function to decrease the slider value
            minusButton3.addEventListener("click", function () {
                if (slider3.value > slider3.min) {
                    slider3.value = parseInt(slider3.value) - 1;
                    updateSlider3Value(); // Update the displayed value
                }
            });

            // Function to update the displayed value
            function updateSlider3Value() {
                var slider3Value = document.getElementById("slider3-value");
                slider3Value.textContent = slider3.value;
            }

            // Call the updateSliderValue function to initialize the displayed value
            updateSlider3Value();

            const textbox = document.getElementById('core-count');

            const hostLocalCheckbox = document.getElementById('host-local-checkbox');
            const networkCheckbox= document.getElementById('network-checkbox');

            document.getElementById('button1').addEventListener('click', function () {
                const sliderVal = slider.value;
                const imageElement = document.getElementById('dynamic-image');
                launchMlcScript('launch-mlc',sliderVal);
                imageElement.src = '/static/no-hostcc.jpg';
            });
            
            document.getElementById('button2').addEventListener('click', function () {
                const imageElement = document.getElementById('dynamic-image');
                killMlcScript('kill-mlc');
                imageElement.src = '/static/no-hostcc.jpg';
            });

            document.getElementById('button5').addEventListener('click', function () {
                const slider3Val = slider3.value;
                const imageElement = document.getElementById('dynamic-image');
                launchIperfScript('launch-iperf',slider3Val);
                imageElement.src = '/static/no-hostcc.jpg';
            });
            
            document.getElementById('button6').addEventListener('click', function () {
                const imageElement = document.getElementById('dynamic-image');
                killIperfScript('kill-iperf');
                imageElement.src = '/staticno-hostcc.jpg';
            });

            document.getElementById('button7').addEventListener('click', function () {
                const textboxVal= textbox.value;
                launchNetperfScript('launch-netperf',textboxVal);
            });
            
            document.getElementById('button8').addEventListener('click', function () {
                killNetperfScript('kill-netperf');
            });

            document.getElementById('button3').addEventListener('click', function () {
                const slider2Val = slider2.value;
                const imageElement = document.getElementById('dynamic-image');
                const hostLocalCheckboxVal = hostLocalCheckbox.checked; // true if checked, false if not checked
                const networkCheckboxVal = networkCheckbox.checked; // true if checked, false if not checked
                loadHostCCScript('load-hostcc',slider2Val,hostLocalCheckboxVal,networkCheckboxVal);
                if (hostLocalCheckboxVal && networkCheckboxVal){
                    imageElement.src = '/static/hostcc.jpg';
                }
                else if(hostLocalCheckboxVal){
                    imageElement.src = '/static/hostcc-local.jpg';
                }
                else if(networkCheckboxVal){
                    imageElement.src = '/static/hostcc-network.jpg';
                }
                else{
                    imageElement.src = '/static/no-hostcc.jpg';
                }
            });
            
            document.getElementById('button4').addEventListener('click', function () {
                const imageElement = document.getElementById('dynamic-image');
                unloadHostCCScript('unload-hostcc');
                imageElement.src = '/static/no-hostcc.jpg';
            });
        });
    
        function launchMlcScript(scriptName, sliderVal) {
            fetch('/launch-mlc', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ script: scriptName, slider: sliderVal })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            });
        }

        function killMlcScript(scriptName) {
            fetch('/kill-mlc', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ script: scriptName })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            });
        }

        function launchIperfScript(scriptName, sliderVal) {
            fetch('/launch-iperf', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ script: scriptName, slider: sliderVal })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            });
        }

        function killIperfScript(scriptName) {
            fetch('/kill-iperf', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ script: scriptName })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            });
        }

        function launchNetperfScript(scriptName, textboxVal) {
            fetch('/launch-netperf', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ script: scriptName, textbox: textboxVal })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            });
        }

        function killNetperfScript(scriptName) {
            fetch('/kill-netperf', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ script: scriptName })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            });
        }

        function loadHostCCScript(scriptName, sliderVal, hostLocalResponseVal, networkResponseVal) {
            fetch('/load-hostcc', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ script: scriptName, slider: sliderVal, hostlocalresponse: hostLocalResponseVal, networkresponse: networkResponseVal })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            });
        }

        function unloadHostCCScript(scriptName) {
            fetch('/unload-hostcc', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ script: scriptName })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            });
        }

        function updateHostCCTargetBWScript(scriptName, sliderVal) {
            fetch('/update-hostcc-targetbw', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ script: scriptName, slider: sliderVal })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
            });
        }
    </script>


    <!-- <div id="cpu-plot"></div> -->

    <script>
        function updateCpuPlot(n) {
            fetch(`/get_last_n_cpu_data/${n}`)
                .then(response => response.json())
                .then(data => {
                    var trace = {
                        x: data.timestamps.map(ts => new Date(ts * 1000)),
                        y: data.utilizations,
                        fill: 'tozeroy',  // Fill the area below the line with color
                        fillcolor: 'rgba(0, 100, 80, 0.9)',  // Specify the fill color
                        line: { color: 'rgb(0, 100, 80)', width: 4 },  // Line color
                        type: 'scatter',
                    };
                    var layout = {
                        font: {
                        family: 'Roboto, sans-serif' // Replace 'YourFontFamily' with the desired font name
                    },
                        title: `CPU Utilization vs Time`,
                        xaxis: { title: 'Time (HH:MM:SS)',
                        range: [new Date() - 120000, new Date()], // Set fixed 60-second range
                        type: 'date' // Specify the x-axis type as date 
                    },
                        yaxis: { title: 'CPU Utilization', range: [0, 100]}, plot_bgcolor: 'lightyellow',paper_bgcolor: 'rgb(198, 196, 232)',
                        margin: {
                        t: 60, // Adjust this value to reduce the gap
                        b: 60,
                    },
                    };
                    Plotly.newPlot('cpu-plot', [trace], layout);
                });
        }
    
        // Call the function with the desired N value
        updateCpuPlot(200);  // Change this to your desired N value
        setInterval(() => updateCpuPlot(200), 1000);  // Change N value here as well
    </script>

<!-- <div id="pcie-plot"></div> -->

<script>
    function updatePciePlot(n) {
        fetch(`/get_last_n_pcie_data/${n}`)
            .then(response => response.json())
            .then(data => {
                var trace = {
                    x: data.timestamps.map(ts => new Date(ts * 1000)),
                    y: data.pcie_bws,
                    fill: 'tozeroy',  // Fill the area below the line with color
                    fillcolor: 'rgba(0, 150, 30, 0.9)',  // Specify the fill color
                    line: { color: 'rgb(0, 100, 80)', width: 4 },  // Line color
                    type: 'scatter'
                };
                var layout = {
                    font: {
                        family: 'Roboto, sans-serif' // Replace 'YourFontFamily' with the desired font name
                    },
                    title: `Network Throughput (Gbps) vs Time`,
                    xaxis: { title: 'Time (HH:MM:SS)',
                        range: [new Date() - 120000, new Date()], // Set fixed 60-second range
                        type: 'date' // Specify the x-axis type as date 
                    },
                    yaxis: { title: 'Throughput (Gbps)', range: [0, 100], tickvals: [0, 20, 40, 60, 80, 100]}, plot_bgcolor: 'rgb(230, 230, 232)',paper_bgcolor: 'rgb(208, 208, 232)', 
                    // height: '10%',
                    margin: {
                        t: 60, // Adjust this value to reduce the gap
                        b: 60,
                    },
                };
                Plotly.newPlot('pcie-plot', [trace], layout);
            });
    }

    // Call the function with the desired N value
    updatePciePlot(200);  // Change this to your desired N value
    setInterval(() => updatePciePlot(200), 1000);  // Change N value here as well
</script>

<!-- <div id="membw-plot"></div> -->

<script>
    function updateMembwPlot(n) {
        fetch(`/get_last_n_membw_data/${n}`)
            .then(response => response.json())
            .then(data => {
                var trace = {
                    x: data.timestamps.map(ts => new Date(ts * 1000)),
                    y: data.mem_bws,
                    fill: 'tozeroy',  // Fill the area below the line with color
                    fillcolor: 'rgba(60, 150, 170, 0.9)',  // Specify the fill color
                    line: { color: 'rgb(50, 50, 170)', width: 4 },  // Line color
                    type: 'scatter'
                };
                var layout = {
                    font: {
                        family: 'Roboto, sans-serif' // Replace 'YourFontFamily' with the desired font name
                    },
                    title: `Memory Bandwidth Utilization (%) vs Time`,
                    xaxis: { title: 'Time (HH:MM:SS)',
                        range: [new Date() - 120000, new Date()], // Set fixed 60-second range
                        type: 'date' // Specify the x-axis type as date 
                    },
                    yaxis: { title: 'MemBW Utilization (%)', range: [0, 100]}, plot_bgcolor: 'rgb(230, 230, 232)',paper_bgcolor: 'rgb(208, 208, 232)',
                    margin: {
                        t: 60, // Adjust this value to reduce the gap
                        b: 60,
                    },
                };
                Plotly.newPlot('membw-plot', [trace], layout);
            });
    }

    // Call the function with the desired N value
    updateMembwPlot(200);  // Change this to your desired N value
    setInterval(() => updateMembwPlot(200), 1000);  // Change N value here as well
</script>

<!-- <div id="drop-rates-plot"></div> -->

<script>
    function updateDropRatesPlot(n) {
        fetch(`/get_last_n_drops_data/${n}`)
            .then(response => response.json())
            .then(data => {
                var trace = {
                    x: data.timestamps.map(ts => new Date(ts * 1000)),
                    y: data.drop_rates,
                    fill: 'tozeroy',  // Fill the area below the line with color
                    fillcolor: 'rgba(255, 71, 76, 0.9)',  // Specify the fill color
                    line: { color: 'rgb(100, 20, 20)', width: 4 },  // Line color
                    type: 'scatter'
                };
                var layout = {
                    font: {
                        family: 'Roboto, sans-serif' // Replace 'YourFontFamily' with the desired font name
                    },
                    title: `Drop Rate (%) vs Time`,
                    xaxis: { title: 'Time (HH:MM:SS)',
                        range: [new Date() - 120000, new Date()], // Set fixed 60-second range
                        type: 'date' // Specify the x-axis type as date 
                    },
                    // yaxis: { title: 'Drop Rate (%)', type: 'log', autorange: false, range: [-5, 1]  }, plot_bgcolor: 'rgb(230, 230, 232)',paper_bgcolor: 'rgb(208, 208, 232)',
                    yaxis: { title: 'Drop Rate (%)', range: [0, 0.5]  }, plot_bgcolor: 'rgb(230, 230, 232)',paper_bgcolor: 'rgb(208, 208, 232)',
                    margin: {
                        t: 60, // Adjust this value to reduce the gap
                        b: 60,
                    },
                };
                Plotly.newPlot('drop-rates-plot', [trace], layout);
            });
    }

    // Call the function with the desired N value
    updateDropRatesPlot(200);  // Change this to your desired N value
    setInterval(() => updateDropRatesPlot(200), 1000);  // Change N value here as well
</script>

<!-- <div id="latencies-plot"></div> -->

<script>
    function updateLatenciesPlot(n) {
        fetch(`/get_last_n_latency_data/${n}`)
            .then(response => response.json())
            .then(data => {
                var lineColors = ['rgb(0, 100, 0)', 'rgb(0, 128, 0)', 'rgb(0, 160, 0)'];

                var trace3 = {
                    x: data.timestamps.map(ts => new Date(ts * 1000)),
                    y: data.p9999_latencies,
                    fill: 'tozeroy',  // Fill the area below the line with color
                    fillcolor: 'rgba(0, 210, 0, 0.9)', // Lighter shade of green (adjust alpha value)
                    line: { color: lineColors[2], width: 4 },
                    type: 'scatter',
                    name: 'P99.99 Latency'
                };

               var trace2 = {
                    x: data.timestamps.map(ts => new Date(ts * 1000)),
                    y: data.p999_latencies,
                    fill: 'tozeroy',  // Fill the area below the line with color
                    fillcolor: 'rgba(0, 140, 0, 0.9)', // Lighter shade of green (adjust alpha value)
                    line: { color: lineColors[1], width: 4 },
                    type: 'scatter',
                    name: 'P99.9 Latency'
                };

                var trace1 = {
                    x: data.timestamps.map(ts => new Date(ts * 1000)),
                    y: data.p99_latencies,
                    fill: 'tozeroy',  // Fill the area below the line with color
                    fillcolor: 'rgba(0, 70, 0, 0.9)', // Lighter shade of green (adjust alpha value)
                    line: { color: lineColors[0], width: 4 },
                    type: 'scatter',
                    name: 'P99 Latency'
                };


                // var trace = {
                //     x: data.timestamps.map(ts => new Date(ts * 1000)),
                //     y: data.p99_latencies,
                //     fill: 'tozeroy',  // Fill the area below the line with color
                //     fillcolor: 'rgba(255, 71, 76, 0.9)',  // Specify the fill color
                //     line: { color: 'rgb(100, 20, 20)', width: 4 },  // Line color
                //     type: 'scatter'
                // };
                var layout = {
                    font: {
                        family: 'Roboto, sans-serif' // Replace 'YourFontFamily' with the desired font name
                    },
                    title: `Tail Latency (us) vs Time`,
                    xaxis: { title: 'Time (HH:MM:SS)',
                        range: [new Date() - 120000, new Date()], // Set fixed 60-second range
                        type: 'date' // Specify the x-axis type as date 
                    },
                    yaxis: { title: 'Latency (us)', type: 'log', autorange: false, range: [1, 6]  }, plot_bgcolor: 'rgb(230, 230, 232)',paper_bgcolor: 'rgb(208, 208, 232)',
                    // yaxis: { title: 'Latency (us)',  }, plot_bgcolor: 'rgb(230, 230, 232)',paper_bgcolor: 'rgb(208, 208, 232)',
                    margin: {
                        t: 60, // Adjust this value to reduce the gap
                        b: 60,
                    },
                    legend: {
                        x: 0.5,  // Adjust the x position (centered)
                        y: 1.0,  // Adjust the y position (above the plot)
                        traceorder: "reversed", // Display legend items in the specified order
                        // bordercolor: 'black', // Add a border around the legend
                        // borderwidth: 1,       // Set the border width
                        xanchor: "center",    // Center the legend
                        yanchor: "bottom",    // Anchor to the top
                        orientation: "h",     // Display legend horizontally
                        xgap: 5,              // Adjust horizontal gap between legend items
                        ygap: 5,              // Adjust vertical gap between legend items
                        // bgcolor: 'white',     // Set legend background color
                        font: { size: 11 }    // Adjust font size
                    },
                };
                Plotly.newPlot('latencies-plot', [trace3, trace2, trace1], layout);
            });
    }

    // Call the function with the desired N value
    updateLatenciesPlot(200);  // Change this to your desired N value
    setInterval(() => updateLatenciesPlot(200), 1000);  // Change N value here as well
</script>

<!-- <div id="iio-occ-plot"></div> -->

<script>
    function updateIIOOccPlot(n) {
        fetch(`/get_last_n_iio_data/${n}`)
            .then(response => response.json())
            .then(data => {
                var trace = {
                    x: data.timestamps.map(ts => new Date(ts * 1000)),
                    y: data.iio_occs,
                    fill: 'tozeroy',  // Fill the area below the line with color
                    fillcolor: 'rgba(249, 170, 50, 0.9)',  // Specify the fill color
                    line: { color: 'rgb(249, 115, 6)', width: 4 },  // Line color
                    type: 'scatter'
                };
                var layout = {
                    font: {
                        family: 'Roboto, sans-serif' // Replace 'YourFontFamily' with the desired font name
                    },
                    title: `IIO Occupancy (cachelines) vs Time`,
                    xaxis: { title: 'Time (HH:MM:SS)',
                        range: [new Date() - 120000, new Date()], // Set fixed 60-second range
                        type: 'date' // Specify the x-axis type as date 
                    },
                    yaxis: { title: 'IIO Occupancy <br> (99.9p over 1s interval)', range: [50, 100], tickvals: [50, 60, 70, 80, 90, 100]  }, plot_bgcolor: 'rgb(230, 230, 232)',paper_bgcolor: 'rgb(208, 208, 232)',
                    margin: {
                        t: 60, // Adjust this value to reduce the gap
                        b: 60,
                    },
                };
                Plotly.newPlot('iio-occ-plot', [trace], layout);
            });
    }

    // Call the function with the desired N value
    updateIIOOccPlot(200);  // Change this to your desired N value
    setInterval(() => updateIIOOccPlot(200), 1000);  // Change N value here as well
</script>

<script>
    function handleCheckboxChange() {
        // const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        // checkboxes.forEach(checkbox => {
        //     const checkboxValue = checkbox.value;
        //     const plot = document.getElementById(checkboxValue + "-plot");

        //     if (checkbox.checked) {
        //         plot.style.display = "block"; // Show the corresponding plot
        //     } else {
        //         plot.style.display = "none"; // Hide the corresponding plot
        //     }
        // });

        const checkboxes = document.querySelectorAll('.checkbox-label input[type="checkbox"]');
        const customPlotGrid = document.getElementById("custom-plot-grid");
        customPlotGrid.innerHTML = ''; // Clear the existing content

        checkboxes.forEach(checkbox => {
            const checkboxValue = checkbox.value;

            if (checkbox.checked) {
                const plotHTML = `<div class="plot" id="${checkboxValue}-plot"></div>`;
                customPlotGrid.innerHTML += plotHTML; // Append the plot HTML
            }
        });
    }

    // Toggle the display of the dropdown content
    function toggleDropdown() {
        var dropdown = document.getElementById("checkbox-list");
        if (dropdown.style.display === "block") {
            dropdown.style.display = "none";
        } else {
            dropdown.style.display = "block";
            // handleCheckboxChange();
        }
    }

    // Call handleCheckboxChange() when the dashboard loads
    handleCheckboxChange();
</script>
</body>
</html>
